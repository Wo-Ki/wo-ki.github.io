<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>é˜¿é‡Œäº‘ECSä¸Šæ­å»ºopenVPN | Wo-Ki</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://wo-ki.github.io/favicon.ico?v=1612101490230">
<link rel="stylesheet" href="https://wo-ki.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ä¸€ã€ç®€ä»‹

å¤–ç½‘æ— æ³•è®¿é—®å†…ç½‘ä¸»æœºï¼Œæ‰€ä»¥éœ€è¦æ‰“é€š
openVPNå¯ä»¥å€ŸåŠ©æœ‰å…¬ç½‘çš„è®¾å¤‡ï¼ˆæœ¬æ–‡æ˜¯é˜¿é‡Œäº‘ECSï¼‰ï¼Œå°†å†…ç½‘æœºå™¨æš´éœ²åœ¨å…¬ç½‘æœºå™¨ä¸­ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤–ç½‘è®¿é—®

äºŒã€ç¯å¢ƒ

ï¼ˆæœåŠ¡ç«¯ï¼‰é˜¿é‡Œäº‘ECSï¼ˆä¹å—ä¹ï¼‰ï¼šubuntu 18.04
ï¼ˆå®¢æˆ·ç«¯ï¼‰u..." />
    <meta name="keywords" content="" />
    <!--Leancloud æ“ä½œåº“:-->
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <!--Valine çš„æ ¸å¿ƒä»£ç åº“-->
    <script src="//cdn.jsdelivr.net/npm/valine@1.4.4/dist/Valine.min.js"></script>
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://wo-ki.github.io">
        <img src="https://wo-ki.github.io/images/avatar.png?v=1612101490230" class="site-logo">
        <h1 class="site-title">Wo-Ki</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      ğŸ“
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://wo-ki.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">é˜¿é‡Œäº‘ECSä¸Šæ­å»ºopenVPN</h2>
            <div class="post-date">2021-01-15</div>
            
            <div class="post-content" v-pre>
              <h1 id="ä¸€-ç®€ä»‹">ä¸€ã€ç®€ä»‹</h1>
<ul>
<li>å¤–ç½‘æ— æ³•è®¿é—®å†…ç½‘ä¸»æœºï¼Œæ‰€ä»¥éœ€è¦æ‰“é€š</li>
<li>openVPNå¯ä»¥å€ŸåŠ©æœ‰å…¬ç½‘çš„è®¾å¤‡ï¼ˆæœ¬æ–‡æ˜¯é˜¿é‡Œäº‘ECSï¼‰ï¼Œå°†å†…ç½‘æœºå™¨æš´éœ²åœ¨å…¬ç½‘æœºå™¨ä¸­ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤–ç½‘è®¿é—®</li>
</ul>
<h1 id="äºŒ-ç¯å¢ƒ">äºŒã€ç¯å¢ƒ</h1>
<ul>
<li>ï¼ˆæœåŠ¡ç«¯ï¼‰é˜¿é‡Œäº‘ECSï¼ˆä¹å—ä¹ï¼‰ï¼šubuntu 18.04</li>
<li>ï¼ˆå®¢æˆ·ç«¯ï¼‰ubuntuä¸»æœºå’ŒMacBook pro</li>
</ul>
<h1 id="ä¸‰-æœåŠ¡ç«¯å®‰è£…">ä¸‰ã€æœåŠ¡ç«¯å®‰è£…</h1>
<h2 id="1å®‰è£…openvpn">1.å®‰è£…OpenVPN</h2>
<p>OpenVPNåœ¨Ubuntuçš„é»˜è®¤ä»“åº“ä¸­æ˜¯å¯ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ç”¨ä½¿ç”¨aptæ¥å®‰è£…ã€‚æˆ‘ä»¬è¿˜éœ€å®‰è£…ä¸€ä¸ªeasy-rsaåŒ…ï¼Œè¿™ä¸ªåŒ…å¯ä»¥å¸®åŠ©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå†…éƒ¨CAï¼ˆcertificate authorityï¼‰ç”¨äºä½¿ç”¨æˆ‘ä»¬VPNã€‚<br>
æ›´æ–°ä½ çš„æœåŠ¡å™¨åŒ…ç´¢å¼•å¹¶å®‰è£…å¿…è¦çš„åŒ…ç±»å‹ï¼š</p>
<pre><code class="language-bash">$ sudo apt-get update
$ sudo apt-get install openvpn easy-rsa
</code></pre>
<p>æºç å®‰è£…ï¼ˆfor centOSï¼‰ï¼š</p>
<pre><code class="language-bash">wget https://github.com/OpenVPN/openvpn/archive/v2.4.9.tar.gz
mv v2.4.9.tar.gz openvpn-2.4.9.tar.gz
tar xf openvpn-2.4.9.tar.gz 
cd openvpn-2.4.9/
autoreconf -i -v -f
./configure --prefix=/usr/local/openvpn --enable-lzo --enable-lz4 --enable-crypto --enable-server --enable-plugins --enable-port-share --enable-iproute2 --enable-pf --enable-plugin-auth-pam --enable-pam-dlopen --enable-systemd
make &amp;&amp; make install
ln -s /usr/local/openvpn/sbin/openvpn /usr/local/sbin/openvpn
</code></pre>
<h2 id="2è®¾ç½®caç›®å½•">2.è®¾ç½®CAç›®å½•</h2>
<p>OpenVPN æ˜¯ä½¿ç”¨ TLS/SSL çš„ VPNã€‚è¿™æ„å‘³ç€å®ƒåˆ©ç”¨è¯ä¹¦æ¥åŠ å¯†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚ä¸ºäº†å‘å¸ƒå—ä¿¡ä»»çš„è¯ä¹¦ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªè‡ªå·±çš„ç®€å•çš„è¯ä¹¦é¢å‘æœºæ„(CA)ã€‚ ä½¿ç”¨ <strong>make-cadir</strong> å‘½ä»¤å¤åˆ¶ easy-rsa æ¨¡æ¿åˆ° home ç›®å½•</p>
<pre><code class="language-bash">$ make-cadir ~/openvpn/openvpn-ca
</code></pre>
<p>æ¥ç€è¿›å…¥åˆšåˆšæ–°å»ºçš„ç›®å½•å‡†å¤‡é…ç½® CA:</p>
<pre><code class="language-bash">$ cd ~/openvpn/openvpn-ca
$ ln -s openssl-1.0.0.cnf openssl.cnf
</code></pre>
<h2 id="3é…ç½®caå˜é‡">3.é…ç½®CAå˜é‡</h2>
<p>è¿›å…¥** ~/openvpn/openvpn-ca** ç›®å½•åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ vars æ–‡ä»¶ï¼Œä»¥ä¾¿äºç”Ÿæˆéœ€è¦çš„ CA å€¼ã€‚<br>
åœ¨æ–‡ä»¶åº•éƒ¨æ‰¾åˆ°ä»¥ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-bash">export KEY_COUNTRY=&quot;US&quot;
export KEY_PROVINCE=&quot;CA&quot;
export KEY_CITY=&quot;SanFrancisco&quot;
export KEY_ORG=&quot;Fort-Funston&quot;
export KEY_EMAIL=&quot;me@myhost.mydomain&quot;
export KEY_OU=&quot;MyOrganizationalUnit&quot;
...
</code></pre>
<p>å°†è¿™äº›å˜é‡ä¿®æ”¹ä¸ºä»»æ„ä½ å–œæ¬¢çš„å€¼ï¼Œä½†æ˜¯ä¸è¦ä¸ºç©ºï¼š</p>
<pre><code class="language-bash">...
export KEY_COUNTRY=&quot;CN&quot;
export KEY_PROVINCE=&quot;ZJ&quot;
export KEY_CITY=&quot;HZ&quot;
export KEY_ORG=&quot;www.woki.com&quot;
export KEY_EMAIL=&quot;wangqiang1588@sina.com&quot;
export KEY_OU=&quot;com.woki&quot;
...
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬è¿˜è¦ä¿®æ”¹ç´§æ¥ç€å‡ºç°çš„ KEY_NAME çš„å€¼ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬æ”¹ä¸º <strong>server</strong>ï¼š</p>
<pre><code class="language-bash">export KEY_NAME=&quot;server&quot;
</code></pre>
<h2 id="4æ„å»ºcaè¯ä¹¦">4.æ„å»ºCAè¯ä¹¦</h2>
<p>é¦–å…ˆè¿›å…¥ä½ çš„ CA ç›®å½•ï¼Œç„¶åæ‰§è¡Œ source vars :</p>
<pre><code class="language-bash">$ cd ~/openvpn/openvpn-ca
$ source vars
</code></pre>
<p>æ¥ç€ä¼šæœ‰ä»¥ä¸‹è¾“å‡ºï¼š</p>
<pre><code class="language-bash">NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/ubuntu/openvpn/openvpn-ca/keys
</code></pre>
<p>æ‰§è¡Œä¸‹åˆ—æ“ä½œç¡®ä¿æ“ä½œç¯å¢ƒå¹²å‡€ï¼š</p>
<pre><code class="language-bash">$ ./clean-all
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ„å»ºæ ¹ CAï¼š</p>
<pre><code class="language-bash"># å¦‚æœæ‰§è¡Œæ—¶å€™æŠ¥é”™
# grep: /etc/openvpn/easy-rsa/2.0/openssl.cnf: No such file or directory
# pkitool: KEY_CONFIG (set by the ./vars script) is pointing to the wrong
# version of openssl.cnf: /etc/openvpn/easy-rsa/2.0/openssl.cnf
# The correct version should have a comment that says: easy-rsa version 2.x
# åˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¿®å¤
# ln -s openssl-1.0.0.cnf openssl.cnf
 
$ ./build-ca
</code></pre>
<p>è¿™å°†ä¼šå¯åŠ¨åˆ›å»ºæ ¹è¯ä¹¦é¢å‘å¯†é’¥ã€è¯ä¹¦çš„è¿‡ç¨‹ã€‚ç”±äºæˆ‘ä»¬åˆšæ‰ä¿®æ”¹äº† vars æ–‡ä»¶ï¼Œæ‰€æœ‰å€¼åº”è¯¥éƒ½ä¼šè‡ªåŠ¨å¡«å……ã€‚æ‰€ä»¥ï¼Œä¸€è·¯å›è½¦å°±å¥½äº†ï¼š</p>
<pre><code class="language-bash">Generating a 2048 bit RSA private key
..........................................................................................+++
...............................+++
writing new private key to 'ca.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [CN]:
State or Province Name (full name) [ZJ]:
Locality Name (eg, city) [HZ]:
Organization Name (eg, company) [www.woki.com]:
Organizational Unit Name (eg, section) [com.woki]:
Common Name (eg, your name or your server's hostname) [www.woki.com CA]:
Name [woki]:
Email Address [wangqiang1588@sina.com]:
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æœ‰äº†åˆ›å»ºä»¥ä¸‹æ­¥éª¤éœ€è¦çš„ CA è¯ä¹¦ã€‚</p>
<h2 id="5åˆ›å»ºæœåŠ¡å™¨ç«¯è¯ä¹¦-å¯†é’¥å’ŒåŠ å¯†æ–‡ä»¶">5.åˆ›å»ºæœåŠ¡å™¨ç«¯è¯ä¹¦ã€å¯†é’¥å’ŒåŠ å¯†æ–‡ä»¶</h2>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤ç”ŸæˆæœåŠ¡å™¨ç«¯è¯ä¹¦å’Œç§˜é’¥ï¼š</p>
<pre><code class="language-bash">$ ./build-key-server server
</code></pre>
<p>æ³¨ï¼šserver å°±æ˜¯åˆšæ‰åœ¨ vars æ–‡ä»¶ä¸­ä¿®æ”¹çš„ KEY_NAME å˜é‡çš„å€¼ã€‚è¯·ä¸è¦ä½¿ç”¨åˆ«çš„åå­—ï¼ ç„¶åä¸€ç›´å›è½¦é€‰æ‹©é»˜è®¤å€¼å³å¯ï¼Œä¸è¦è®¾ç½® challenge password ï¼Œç›´æ¥å›è½¦å³å¯ã€‚åˆ°æœ€åï¼Œä½ éœ€è¦è¾“å…¥ä¸¤æ¬¡ y æ³¨å†Œè¯ä¹¦å’Œæäº¤ã€‚</p>
<pre><code class="language-bash">...
Certificate is to be certified until May  1 17:51:16 2026 GMT (3650 days)
Sign the certificate? [y/n]:y
1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
</code></pre>
<p>ç„¶åè¿˜éœ€è¦ç”Ÿæˆä¸€äº›å…¶ä»–ä¸œè¥¿ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­ç”Ÿæˆä¸€ä¸ªå¼ºå¤§çš„ Diffie-Hellman å¯†é’¥:</p>
<pre><code class="language-bash">$./build-dh
</code></pre>
<p>è¿™ä¸ªæ“ä½œå¤§çº¦ä¼šèŠ±è´¹å‡ åˆ†é’Ÿä¸ç­‰ã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆ HMAC ç­¾ååŠ å¼ºæœåŠ¡å™¨çš„ TLS å®Œæ•´æ€§éªŒè¯åŠŸèƒ½ï¼š</p>
<pre><code class="language-bash">$ openvpn --genkey --secret keys/ta.key
</code></pre>
<h2 id="6é…ç½®-openvpn-æœåŠ¡">6.é…ç½® OPENVPN æœåŠ¡</h2>
<p>é¦–å…ˆå°†åˆšåˆšç”Ÿæˆçš„å„ç±»æ–‡ä»¶å¤åˆ¶åˆ° OpenVPN ç›®å½•ä¸‹ï¼š</p>
<pre><code class="language-bash">$ cd ~/openvpn/openvpn-ca/keys
$ sudo cp ca.crt ca.key server.crt server.key ta.key dh2048.pem /etc/openvpn
</code></pre>
<p>ç„¶åï¼Œè§£å‹å¹¶å¤åˆ¶ä¸€ä¸ª OpenVPN é…ç½®æ–‡ä»¶åˆ° OpenVPN ç›®å½•ï¼š</p>
<pre><code class="language-bash">$ gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | sudo tee /etc/openvpn/server.conf
$ sudo mkdir -p /etc/openvpn/ccd
</code></pre>
<p>æ¥ç€æ›´æ”¹é…ç½®,å»æ‰æ³¨é‡Šä¹‹åï¼Œç²¾ç®€çš„å…³é”®ä¿¡æ¯å¦‚ä¸‹** /etc/openvpn/server.conf**ï¼š</p>
<pre><code class="language-bash">port 1194
proto tcp
dev tun
ca ca.crt
cert server.crt
key server.key
dh dh2048.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
client-config-dir ccd
client-to-client
keepalive 10 120
tls-auth ta.key 0
key-direction 0
cipher AES-256-CBC
comp-lzo
user nobody
group nogroup
persist-key
persist-tun
status openvpn-status.log
verb 3
</code></pre>
<h2 id="6è°ƒæ•´æœåŠ¡å™¨ç½‘ç»œé…ç½®">6.è°ƒæ•´æœåŠ¡å™¨ç½‘ç»œé…ç½®</h2>
<p>é¦–å…ˆï¼Œç¡®è®¤UFWé˜²ç«å¢™çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€ä¸ºå¼€å¯ï¼Œåˆ™è°ƒæ•´ã€‚å¦‚æœé˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œåˆ™ä¸éœ€è¦è°ƒæ•´ã€‚</p>
<pre><code class="language-bash">sudo ufw status
</code></pre>
<p>å¦‚æœè¾“å‡ºæ˜¯<strong>Status: inactive</strong>, é‚£ä¹ˆä¸éœ€è¦è¿›è¡Œä¸‹é¢çš„è°ƒæ•´ã€‚<br>
æ³¨æ„ï¼Œä¸‹é¢çš„è°ƒæ•´å¦‚æœä¸­é—´å‡ºç°é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´é˜²ç«å¢™æ‹¦æˆªSSHè¿›è€Œæ— æ³•è¿›è¡Œæ¢å¤æ“ä½œã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘æä¾›çš„è¿œç¨‹æ§åˆ¶å°åœ¨ç½‘é¡µç«¯è¿›è¡Œæ¢å¤æ“ä½œã€‚</p>
<h2 id="7å¯åŠ¨openvpn">7.å¯åŠ¨OPENVPN</h2>
<pre><code class="language-bash">$ sudo mkdir -p /etc/openvpn/ccd
$ sudo systemctl start openvpn@server
#å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è§‚å¯Ÿæ—¥å¿—
# sudo tail -f /var/log/syslog
</code></pre>
<p>è®¾ç½®å¼€æœºè‡ªå¯ï¼š</p>
<pre><code class="language-bash">$ sudo systemctl enable openvpn@server
</code></pre>
<h1 id="å››-é˜¿é‡Œäº‘å¼€å¯ç«¯å£">å››ã€é˜¿é‡Œäº‘å¼€å¯ç«¯å£</h1>
<p>åœ¨é˜¿é‡Œäº‘ç®¡ç†ç•Œé¢ä¸­ï¼Œé…ç½®ECSå®‰å…¨ç»„çš„1194ç«¯å£ä¸ºå¼€æ”¾</p>
<h1 id="äº”-å®¢æˆ·ç«¯å®‰è£…é…ç½®">äº”ã€å®¢æˆ·ç«¯å®‰è£…é…ç½®</h1>
<h2 id="1åˆ›å»ºå®¢æˆ·ç«¯é…ç½®">1.åˆ›å»ºå®¢æˆ·ç«¯é…ç½®</h2>
<p>åœ¨<strong>æœåŠ¡ç«¯</strong>ï¼Œç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ã€å¯†é’¥å¯¹ï¼š</p>
<pre><code class="language-bash">$ cd ~/openvpn/openvpn-ca
$ source vars
$ cp /etc/openvpn/ca.crt ./keys/
$ sudo cp /etc/openvpn/ca.key ./keys/
$ sudo cp /etc/openvpn/ta.key ./keys/
$ sudo chmod 755 ./keys/ca.crt
$ sudo chmod 755 ./keys/ta.key
$ ./build-key client-woki
</code></pre>
<p><strong>client-woki</strong>ä¸ºå¯†é’¥å¯¹åç§°ï¼Œç”Ÿæˆè¿‡ç¨‹ä¸­å›è½¦é€‰æ‹©é»˜è®¤é€‰é¡¹å³å¯ã€‚<br>
æ³¨æ„ï¼Œä¸‹é¢è¿™ä¸€æ­¥ä¸€å®šè¦è¾“å…¥ y å¦åˆ™ä¼šè·³è¿‡æœ€åä¸€æ­¥ï¼Œå¯¼è‡´ç”Ÿæˆè¯ä¹¦çš„æ—¶å€™ä¼šç¼ºå°‘éƒ¨åˆ†ä¿¡æ¯ã€‚</p>
<pre><code class="language-bash">Certificate is to be certified until May 29 11:40:12 2029 GMT (3650 days)
Sign the certificate? [y/n]:y
1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
</code></pre>
<p><strong>æ³¨æ„ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯çš„è¯ï¼Œå»ºè®®ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä»½é…ç½®æ–‡ä»¶ã€‚</strong><br>
æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼Œç”Ÿæˆå®¢æˆ·ç«¯é…ç½®çš„åŸºç¡€æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">$ mkdir -p ~/client-configs/files
$ chmod 700 ~/client-configs/files
$ cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf  
</code></pre>
<p>ç„¶åæ‰“å¼€ <strong>~/client-configs/base.conf</strong> æ–‡ä»¶ï¼Œä¿®æ”¹ <strong>remote my-server-1 1194 <strong>ä¸ºæœåŠ¡å™¨å…¬ç½‘IPæˆ–è€…åŸŸåã€‚ ç„¶åæ›´æ”¹å®¢æˆ·ç«¯åè®®ä¸º</strong>tcp</strong>,å»æ‰æ³¨é‡Šåçš„å®Œæ•´é…ç½®ä¸ºï¼š</p>
<pre><code class="language-bash">client
dev tun
proto tcp
remote my-server-1 1194
resolv-retry infinite
nobind
user nobody
group nogroup
persist-key
persist-tun
remote-cert-tls server
cipher AES-256-CBC
key-direction 1
comp-lzo
verb 3
</code></pre>
<h2 id="2åˆ›å»ºé…ç½®ç”Ÿæˆè„šæœ¬">2.åˆ›å»ºé…ç½®ç”Ÿæˆè„šæœ¬</h2>
<p>æ–°å»º** ~/client-configs/make_config.sh** æ–‡ä»¶ï¼Œå¤åˆ¶å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-bash">#!/bin/bash
# First argument: Client identifier
 
cd ~/openvpn/openvpn-ca
source vars
./build-key ${1}
 
KEY_DIR=~/openvpn/openvpn-ca/keys
OUTPUT_DIR=~/client-configs/files
BASE_CONFIG=~/client-configs/base.conf
cat ${BASE_CONFIG} \
    &lt;(echo -e '&lt;ca&gt;') \
    ${KEY_DIR}/ca.crt \
    &lt;(echo -e '&lt;/ca&gt;\n&lt;cert&gt;') \
    ${KEY_DIR}/${1}.crt \
    &lt;(echo -e '&lt;/cert&gt;\n&lt;key&gt;') \
    ${KEY_DIR}/${1}.key \
    &lt;(echo -e '&lt;/key&gt;\n&lt;tls-auth&gt;') \
    ${KEY_DIR}/ta.key \
    &lt;(echo -e '&lt;/tls-auth&gt;') \
    &gt; ${OUTPUT_DIR}/${1}.ovpn
</code></pre>
<p>ä¿å­˜å¹¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼š</p>
<pre><code class="language-bash">$ chmod 700 ~/client-configs/make_config.sh
</code></pre>
<h2 id="3ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®">3.ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®</h2>
<pre><code class="language-bash">$ cd ~/client-configs
$ ./make_config.sh client-woki
</code></pre>
<p>ä½¿ç”¨æ­¤è„šæœ¬ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶æ–¹ä¾¿å®¢æˆ·ç«¯ä½¿ç”¨ã€‚ æ³¨ï¼šéœ€è¦ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥åæ‰å¯ä½¿ç”¨è„šæœ¬ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œclient-woki.ovpn ä¸ºåˆšåˆšç”Ÿæˆçš„å®¢æˆ·ç«¯å¯†é’¥åç§° ç”Ÿæˆåçš„è„šæœ¬å‚¨å­˜åœ¨ ~/client-configs/files ç›®å½•ä¸‹ï¼Œåç§°ä¸º client-woki.ovpnã€‚å°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°å³å¯ä½¿ç”¨äº†ã€‚</p>
<h2 id="4ä¸ºå®¢æˆ·ç«¯è®¾ç½®å›ºå®šip">4.ä¸ºå®¢æˆ·ç«¯è®¾ç½®å›ºå®šIP</h2>
<p>pass</p>
<h2 id="5å®¢æˆ·ç«¯å‘½ä»¤è¡Œä½¿ç”¨">5.å®¢æˆ·ç«¯å‘½ä»¤è¡Œä½¿ç”¨</h2>
<p>é¦–å…ˆå®‰è£…OpenVPN, è¿è¡Œæ—¶é€‰æ‹©é…ç½®ä¸ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">$ sudo apt install openvpn
$ sudo openvpn --config client-woki.ovpn
</code></pre>
<p>ä½¿ç”¨æ­¤æ–¹æ³•å¯ä»¥è®©å®¶é‡Œçš„ç”µè„‘æˆ–è€…æ ‘è“æ´¾ç­‰è®¾å¤‡å®ç°å†…ç½‘ç©¿é€ï¼Œä»è€Œè¿œç¨‹è¿æ¥è¿›è¡Œæ“ä½œã€‚<br>
å¯¹äºå®¢æˆ·ç«¯æ˜¯macOSçš„è®¾å¤‡æ¥è¯´ï¼Œæ¨èä½¿ç”¨<a href="https://en.softonic.com/download/tunnelblick/mac/post-download">Tunnelblick</a></p>
<h2 id="6å®¢æˆ·ç«¯å¼€æœºè‡ªå¯">6.<a href="https://ubuntuqa.com/article/10000.html">å®¢æˆ·ç«¯å¼€æœºè‡ªå¯</a></h2>
<p>åœ¨Ubuntuä¸Šï¼Œæ‚¨æ”¾ç½®åœ¨åä¸º/etc/openvpn/$NAME.confçš„æ–‡ä»¶ä¸­çš„ä»»ä½•VPNé…ç½®éƒ½å°†è‡ªåŠ¨å¯åŠ¨ã€‚<br>
å› æ­¤ï¼Œæ‚¨è¦åšçš„å°±æ˜¯å°†client.ovpnå¤åˆ¶åˆ°/etc/openvpn/client.confã€‚æˆ‘å»ºè®®æ‚¨è¿˜å°†client.confä¸­çš„ç»å¯¹è·¯å¾„ç”¨äºæ‰€æœ‰é”®ï¼Œè„šæœ¬ç­‰ã€‚<br>
å½“ç„¶ï¼Œæ‚¨å¯èƒ½éœ€è¦ä»”ç»†æ£€æŸ¥/etc/default/openvpnæ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰VPNï¼Œä½†AUTOSTARTå€¼å¯èƒ½å·²æ›´æ”¹ä¸ºnoneï¼Œæˆ–è€…æ˜¯è¦è‡ªåŠ¨å¯åŠ¨çš„ç‰¹å®šé…ç½®çš„åˆ—è¡¨ã€‚</p>
<h1 id="å…­-tips">å…­ã€tips</h1>
<h2 id="1-åˆ é™¤errorthere-is-already-a-certificate-for">1. åˆ é™¤ERROR:There is already a certificate for...</h2>
<p>vi /openvpn/openvpn-ca/keys/index.txt</p>
<h2 id="2centosä¸‹æŠ¥é”™">2.CentOSä¸‹æŠ¥é”™</h2>
<pre><code class="language-bash">2021-01-18 14:35:19 DEPRECATED OPTION: --cipher set to 'AES-128-CBC' but missing in --data-ciphers (AES-256-GCM:AES-128-GCM). Future OpenVPN version will ignore --cipher for cipher negotiations. Add 'AES-128-CBC' to --data-ciphers or change --cipher 'AES-128-CBC' to --data-ciphers-fallback 'AES-128-CBC' to silence this warning.
2021-01-18 14:35:19 OpenVPN 2.5.0 x86_64-unknown-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [MH/PKTINFO] [AEAD] built on Jan 18 2021
2021-01-18 14:35:19 library versions: OpenSSL 1.0.2k-fips  26 Jan 2017, LZO 2.06
2021-01-18 14:35:19 Outgoing Control Channel Authentication: Using 256 bit message hash 'SHA256' for HMAC authentication
2021-01-18 14:35:19 Incoming Control Channel Authentication: Using 256 bit message hash 'SHA256' for HMAC authentication
2021-01-18 14:35:19 failed to find GID for group nogroup
2021-01-18 14:35:19 Exiting due to fatal error
</code></pre>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<pre><code class="language-bash">user nobody
group nogroup
</code></pre>
<p>toï¼š</p>
<pre><code class="language-bash">user nobody
group nobody
</code></pre>
<h2 id="3æœåŠ¡ç«¯æŸ¥çœ‹æ‰€æœ‰å®¢æˆ·ç«¯ip">3.<a href="https://qastack.cn/server/571592/how-to-view-connected-users-to-open-vpn-server">æœåŠ¡ç«¯æŸ¥çœ‹æ‰€æœ‰å®¢æˆ·ç«¯ip</a></h2>
<pre><code class="language-bash">cat /etc/openvpn/openvpn-status.log
</code></pre>
<h1 id="ä¸ƒ-todo">ä¸ƒã€TODO</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/57477087">é‡‡ç”¨Frp</a></li>
</ul>
<h1 id="refer">refer:</h1>
<ul>
<li>http://www.mobibrw.com/2019/18982?replytocom=3518</li>
<li>https://www.jzfu.cc/2018/09/04/Ubuntu16-04%E6%90%AD%E5%BB%BAOpenVPN/</li>
<li>https://www.viayc.com/2019/03/21/OpenVPN%E8%AE%BF%E9%97%AE%E5%85%AC%E5%8F%B8%E5%86%85%E7%BD%91/</li>
<li>http://www.zhangblog.com/2020/05/09/openvpn01/</li>
</ul>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://wo-ki.github.io/post/hui-yi-lu/">
                  <h3 class="post-title">
                    å›å¿†å½•
                  </h3>
                </a>
              </div>
            

            

          </div>
        <div class="comment"></div>
        </div>
      </div>
    </div>
   <!--è½½å…¥jsï¼Œåœ¨</body>ä¹‹å‰æ’å…¥å³å¯-->

<!--    <div class="comment"></div>-->
    
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






      
    <script>
        new Valine({
            // AV å¯¹è±¡æ¥è‡ªä¸Šé¢å¼•å…¥av-min.js(è€å¸æœºä»¬ä¸è¦å¼€è½¦â³â™¡ã‚›æ‰å¿ƒäº†è€é“)
            av: AV, 
            el: '.comment',
              lang: 'zh-cn',//è®¾ç½®è¯„è®ºè¯­è¨€
            emoticon_url: 'https://cloud.panjunwen.com/alu',
      emoticon_list: ["ç‹‚æ±—.png","ä¸è¯´è¯.png","æ±—.png","åç­‰.png","çŒ®èŠ±.png","ä¸é«˜å…´.png","ä¸­åˆ€.png","å®³ç¾.png","çš±çœ‰.png","å°çœ¼ç›.png","æš—åœ°è§‚å¯Ÿ.png"],
      app_id: '9L51TcKc1RK71QrjjB8jazVy-gzGzoHsz',
      app_key: 'B1JLE3mnY1vTs7e6elI8hxCV',
      placeholder: 'ç•…æ‰€æ¬²è¨€ï¼Œplsï½'
        });
    </script>    
  </body>
</html>
